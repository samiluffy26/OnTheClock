---
import BookingForm from './BookingForm.astro';
---

<section class="hero">
  <div class="container hero-container">
    <div class="hero-content">
      <h1 class="hero-title">Wheelchair Accessible Rides On Demand</h1>
      <p class="hero-subtitle">100% Secure door-to-door transportation and care.</p>
      
      <div class="hero-image-mobile">
        <img src="/van-with-person.png" alt="Life Ride Van with Healthcare Provider">
      </div>
    </div>
    
    <div class="fare-estimate-card">
      <h2 class="card-title">Fare Estimate</h2>
      
      <form class="fare-form" id="heroFareForm">
        <div class="form-group">
          <div class="autocomplete-wrapper">
            <input 
              type="text" 
              id="pickupLocationHero" 
              name="pickupLocation"
              placeholder="Pick-Up Location (e.g., Miami, FL)" 
              autocomplete="off"
              required
            >
            <div id="pickupLocationHero-suggestions" class="autocomplete-suggestions"></div>
          </div>
        </div>
        
        <div class="form-group">
          <div class="autocomplete-wrapper">
            <input 
              type="text" 
              id="dropoffLocationHero" 
              name="dropoffLocation"
              placeholder="Drop-Off Location (e.g., Orlando, FL)" 
              autocomplete="off"
              required
            >
            <div id="dropoffLocationHero-suggestions" class="autocomplete-suggestions"></div>
          </div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <input type="date" id="rideDateHero" name="rideDate" required>
          </div>
          <div class="form-group">
            <input type="time" id="rideTimeHero" name="rideTime" required>
          </div>
        </div>
        
        <div class="form-group checkbox-group">
          <input type="checkbox" id="returnTripHero" name="returnTrip">
          <label for="returnTripHero">Add a Return Trip</label>
        </div>
        <div class="form-group checkbox-group">
  
</div>


<div id="returnTripFieldsHero" class="return-trip-fields" style="display: none;">
  <div class="form-row">
    <div class="form-group">
      <input type="date" id="returnDateHero" name="returnDate" placeholder="Return Date">
    </div>
    <div class="form-group">
      <input type="time" id="returnTimeHero" name="returnTime" placeholder="Return Time">
    </div>
  </div>
  
  <div class="form-group checkbox-group">
    <input type="checkbox" id="waitOnSiteHero" name="waitOnSite">
    <label for="waitOnSiteHero">Wait on site for return trip ($25/hour)</label>
  </div>
</div>
        
        <button type="submit" class="btn-submit">Get Estimate</button>
      </form>
    </div>
  </div>
  
  <div class="hero-image-desktop">
    <img src="/van-with-person.png" alt="Life Ride Van with Healthcare Provider">
  </div>
</section>

<BookingForm />

<style>
.autocomplete-wrapper {
  position: relative;
  width: 100%;
}

.autocomplete-suggestions {
  position: absolute;
  top: 100%;
  left: 0;
  right: 0;
  background: white;
  border: 1px solid #ddd;
  border-top: none;
  border-radius: 0 0 4px 4px;
  max-height: 250px;
  overflow-y: auto;
  z-index: 1000;
  display: none;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.autocomplete-suggestions.active {
  display: block;
}

.suggestion-item {
  padding: 12px 14px;
  cursor: pointer;
  border-bottom: 1px solid #f0f0f0;
  transition: background-color 0.2s;
  font-size: 14px;
}

.suggestion-item:hover {
  background-color: #f5f5f5;
}

.suggestion-item:last-child {
  border-bottom: none;
}

.suggestion-main {
  font-weight: 500;
  color: var(--text-dark);
}


.return-trip-fields {
  margin-top: 15px;
  padding: 15px;
  background: #f9f9f9;
  border-radius: 8px;
  animation: slideDown 0.3s ease;
}

@keyframes slideDown {
  from {
    opacity: 0;
    max-height: 0;
  }
  to {
    opacity: 1;
    max-height: 300px;
  }
}
</style>

<script>
  import { initAddressAutocomplete } from '../utils/addressAutocomplete.js';
  
  document.addEventListener('DOMContentLoaded', () => {
    // Inicializar autocompletado para los campos del hero
    initAddressAutocomplete('pickupLocationHero');
    initAddressAutocomplete('dropoffLocationHero');
    
    // Inicializar fecha mÃ­nima
    const today = new Date().toISOString().split('T')[0];
    const dateInput = document.getElementById('rideDateHero');
    if (dateInput) {
      dateInput.setAttribute('min', today);
      dateInput.value = today;
    }

    const returnTripHeroCheckbox = document.getElementById('returnTripHero');
  const returnTripFieldsHero = document.getElementById('returnTripFieldsHero');
  
  if (returnTripHeroCheckbox && returnTripFieldsHero) {
    returnTripHeroCheckbox.addEventListener('change', function() {
      returnTripFieldsHero.style.display = this.checked ? 'block' : 'none';
      
      if (!this.checked) {
        document.getElementById('returnDateHero').value = '';
        document.getElementById('returnTimeHero').value = '';
        document.getElementById('waitOnSiteHero').checked = false;
      }
    });
  }
    
    // Establecer hora por defecto (opcional)
    const timeInput = document.getElementById('rideTimeHero');
    if (timeInput && !timeInput.value) {
      const now = new Date();
      const hours = String(now.getHours()).padStart(2, '0');
      const minutes = String(now.getMinutes()).padStart(2, '0');
      timeInput.value = `${hours}:${minutes}`;
    }
    
    // Manejar envÃ­o del formulario
    const heroForm = document.getElementById('heroFareForm');
    if (heroForm) {
      heroForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const pickup = document.getElementById('pickupLocationHero').value.trim();
        const dropoff = document.getElementById('dropoffLocationHero').value.trim();
        const date = document.getElementById('rideDateHero').value;
        const time = document.getElementById('rideTimeHero').value;
        
        // Validar campos
        if (!pickup || !dropoff) {
          alert('Please enter both pickup and drop-off locations');
          return;
        }
        
        if (!date || !time) {
          alert('Please select date and time for your ride');
          return;
        }
        
        // Abrir modal
        if (typeof window.openBookingModal === 'function') {
          window.openBookingModal();
          
          // Prellenar el modal con los datos del hero
          setTimeout(() => {
             const modalPickup = document.querySelector('#step1 input[name="pickupLocation"]');
    const modalDropoff = document.querySelector('#step1 input[name="dropoffLocation"]');
    const modalDate = document.querySelector('#step1 input[name="rideDate"]');
    const modalTime = document.querySelector('#step1 input[name="rideTime"]');
    const modalReturn = document.querySelector('#step1 input[name="returnTrip"]');
    
    // ðŸ†• AGREGAR CAMPOS DE RETORNO
    const modalReturnDate = document.querySelector('#step1 input[name="returnDate"]');
    const modalReturnTime = document.querySelector('#step1 input[name="returnTime"]');
    const modalWaitOnSite = document.querySelector('#step1 input[name="waitOnSite"]');
    
            
             if (modalPickup) modalPickup.value = pickup;
    if (modalDropoff) modalDropoff.value = dropoff;
    if (modalDate) modalDate.value = date;
    if (modalTime) modalTime.value = time;
    if (modalReturn) {
      modalReturn.checked = document.getElementById('returnTripHero').checked;
      // Trigger change event para mostrar campos
      modalReturn.dispatchEvent(new Event('change'));
    }

    // ðŸ†• PRELLENAR CAMPOS DE RETORNO
    if (modalReturnDate) modalReturnDate.value = document.getElementById('returnDateHero')?.value || '';
    if (modalReturnTime) modalReturnTime.value = document.getElementById('returnTimeHero')?.value || '';
    if (modalWaitOnSite) modalWaitOnSite.checked = document.getElementById('waitOnSiteHero')?.checked || false;
          }, 100);
        } else {
          console.error('openBookingModal function not found');
          alert('Error opening booking form. Please try again.');
        }
      });
    }
  });
</script>